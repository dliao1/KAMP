<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>KAMP — kamp • KAMP</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="KAMP — kamp"><meta name="description" content="This function computes the KAMP expectation and variance for a given point pattern.
Calculates Ripley's K using both the traditional Ripley's K method
(based on Kcross) and the KAMP-adjusted CSR baseline (based on Kest).
The KAMP-adjusted CSR represents a more robust baseline for K that accounts for spatial clustering or inhomogeneity
in a point pattern compared to the traditional CSR assumption, while
avoiding the computational burden of permuting the point pattern.
For expectation, this function uses the spatstat package under the hood, which
automatically uses border correction when the number of
points in the point pattern is more than 3000.
For variance, this function utlizes a matrix-based implementation.
See ?Kcross and ?Kest for more details on the K calculation methods.
See kamp_expectation_mat for the matrix-based implementation (Note: currently
not recommended due to slow speed)"><meta property="og:description" content="This function computes the KAMP expectation and variance for a given point pattern.
Calculates Ripley's K using both the traditional Ripley's K method
(based on Kcross) and the KAMP-adjusted CSR baseline (based on Kest).
The KAMP-adjusted CSR represents a more robust baseline for K that accounts for spatial clustering or inhomogeneity
in a point pattern compared to the traditional CSR assumption, while
avoiding the computational burden of permuting the point pattern.
For expectation, this function uses the spatstat package under the hood, which
automatically uses border correction when the number of
points in the point pattern is more than 3000.
For variance, this function utlizes a matrix-based implementation.
See ?Kcross and ?Kest for more details on the K calculation methods.
See kamp_expectation_mat for the matrix-based implementation (Note: currently
not recommended due to slow speed)"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">KAMP</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/kamp_intro.html">Introduction to KAMP</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>KAMP</h1>

      <div class="d-none name"><code>kamp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function computes the KAMP expectation and variance for a given point pattern.
Calculates Ripley's K using both the traditional Ripley's K method
(based on <code>Kcross</code>) and the KAMP-adjusted CSR baseline (based on <code>Kest</code>).</p>
<p>The KAMP-adjusted CSR represents a more robust baseline for K that accounts for spatial clustering or inhomogeneity
in a point pattern compared to the traditional CSR assumption, while
avoiding the computational burden of permuting the point pattern.</p>
<p>For expectation, this function uses the <code>spatstat</code> package under the hood, which
automatically uses border correction when the number of
points in the point pattern is more than 3000.</p>
<p>For variance, this function utlizes a matrix-based implementation.</p>
<p>See <code>?Kcross</code> and <code>?Kest</code> for more details on the K calculation methods.</p>
<p>See <code>kamp_expectation_mat</code> for the matrix-based implementation (Note: currently
not recommended due to slow speed)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">kamp</span><span class="op">(</span></span>
<span>  <span class="va">ppp_obj</span>,</span>
<span>  <span class="va">rvals</span>,</span>
<span>  univariate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">marksvar1</span>,</span>
<span>  marksvar2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  correction <span class="op">=</span> <span class="st">"trans"</span>,</span>
<span>  thin <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  p_thin <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  background <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-ppp-obj">ppp_obj<a class="anchor" aria-label="anchor" href="#arg-ppp-obj"></a></dt>
<dd><p>A point pattern object of class <code>ppp</code> from the <code>spatstat</code> package.</p></dd>


<dt id="arg-rvals">rvals<a class="anchor" aria-label="anchor" href="#arg-rvals"></a></dt>
<dd><p>A vector of distances at which to compute the KAMP expectation and variance.</p></dd>


<dt id="arg-univariate">univariate<a class="anchor" aria-label="anchor" href="#arg-univariate"></a></dt>
<dd><p>A logical value indicating whether to compute univariate KAMP (default is TRUE).</p></dd>


<dt id="arg-marksvar-">marksvar1<a class="anchor" aria-label="anchor" href="#arg-marksvar-"></a></dt>
<dd><p>Variable used to mark the points in the point pattern object for the first type.</p></dd>


<dt id="arg-marksvar-">marksvar2<a class="anchor" aria-label="anchor" href="#arg-marksvar-"></a></dt>
<dd><p>Variable used to mark the points in the point pattern object for the second type (optional, only used if <code>univariate</code> is FALSE).</p></dd>


<dt id="arg-variance">variance<a class="anchor" aria-label="anchor" href="#arg-variance"></a></dt>
<dd><p>A logical value indicating whether to compute the variance of KAMP (default is FALSE).</p></dd>


<dt id="arg-correction">correction<a class="anchor" aria-label="anchor" href="#arg-correction"></a></dt>
<dd><p>Type of edge correction. Defaults to translational.</p></dd>


<dt id="arg-thin">thin<a class="anchor" aria-label="anchor" href="#arg-thin"></a></dt>
<dd><p>A logical value indicating whether to thin the point pattern before computing KAMP (default is FALSE), called KAMP-lite.</p></dd>


<dt id="arg-p-thin">p_thin<a class="anchor" aria-label="anchor" href="#arg-p-thin"></a></dt>
<dd><p>Percentage that determines how much to thin the amount of points in the point pattern object. Default is 0.</p></dd>


<dt id="arg-background">background<a class="anchor" aria-label="anchor" href="#arg-background"></a></dt>
<dd><p>Variable used to define the background for the point pattern object.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to the underlying functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A dataframe with the following columns:</p><dl><dt>r</dt>
<dd><p>The radius at which K was calculated.</p></dd>

<dt>k</dt>
<dd><p>The observed K value</p></dd>

<dt>theo_csr</dt>
<dd><p>The theoretical K under CSR</p></dd>

<dt>kamp_csr</dt>
<dd><p>The adjusted CSR representing the KAMP expectation.</p></dd>

<dt>kamp</dt>
<dd><p>The difference between observed K and KAMP CSR</p></dd>

<dt>var</dt>
<dd><p>If variance = TRUE, variance of K under the KAMP null distribution</p></dd>

<dt>pval</dt>
<dd><p>If variance = TRUE, p-value that estimates the probability of observing a deviation
from the expected KAMP-adjusted value as large or larger than the one
observed, under the null hypothesis of CSR). Calculated using a normal approximation.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Computes KAMP expectation and variance</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Loads required packages</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat.geom</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: spatstat.data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: spatstat.univar</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> spatstat.univar 3.1-4</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> spatstat.geom 3.5-0</span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat.explore</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: spatstat.random</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> spatstat.random 3.4-1</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: nlme</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> spatstat.explore 3.5-2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Simulates a simple marked point pattern</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">marks_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"immune"</span>, <span class="st">"background"</span><span class="op">)</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">win</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/owin.html" class="external-link">owin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ppp_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/ppp.html" class="external-link">ppp</a></span><span class="op">(</span><span class="va">x_coords</span>, <span class="va">y_coords</span>, window <span class="op">=</span> <span class="va">win</span>, marks <span class="op">=</span> <span class="va">marks_vec</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Defines radius values for K-function estimation</span></span></span>
<span class="r-in"><span><span class="va">r_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Computes univariate KAMP expectation</span></span></span>
<span class="r-in"><span><span class="va">kamp_result</span> <span class="op">&lt;-</span> <span class="fu">kamp</span><span class="op">(</span>ppp_obj <span class="op">=</span> <span class="va">ppp_obj</span>,</span></span>
<span class="r-in"><span>                    rvals <span class="op">=</span> <span class="va">r_vals</span>,</span></span>
<span class="r-in"><span>                    univariate <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                    marksvar1 <span class="op">=</span> <span class="st">"immune"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The point pattern object has more than 10000 points. Switching to border correction</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in Kcross(ppp_obj, i = marksvar1, j = marksvar1, r = rvals, correction = correction):</span> Point pattern must be multitype</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kamp_result</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'kamp_result' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute univariate KAMP expectation with thinning</span></span></span>
<span class="r-in"><span><span class="va">kamp_thin</span> <span class="op">&lt;-</span> <span class="fu">kamp</span><span class="op">(</span>ppp_obj <span class="op">=</span> <span class="va">ppp_obj</span>,</span></span>
<span class="r-in"><span>                  rvals <span class="op">=</span> <span class="va">r_vals</span>,</span></span>
<span class="r-in"><span>                  univariate <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                  marksvar1 <span class="op">=</span> <span class="st">"immune"</span>,</span></span>
<span class="r-in"><span>                  thin <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                  p_thin <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The point pattern object has more than 10000 points. Switching to border correction</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in Kcross(ppp_obj, i = marksvar1, j = marksvar1, r = rvals, correction = correction):</span> Point pattern must be multitype</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kamp_thin</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'kamp_thin' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use real data from VectraPolarisData in package</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ovarian_df</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ovarian_df</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">ov_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ovarian_df</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="va">sample_id</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">win</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/convexhull.xy.html" class="external-link">convexhull.xy</a></span><span class="op">(</span><span class="va">ov_df</span><span class="op">$</span><span class="va">x</span>, <span class="va">ov_df</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ppp_real</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/ppp.html" class="external-link">ppp</a></span><span class="op">(</span><span class="va">ov_df</span><span class="op">$</span><span class="va">x</span>, <span class="va">ov_df</span><span class="op">$</span><span class="va">y</span>, window <span class="op">=</span> <span class="va">win</span>, marks <span class="op">=</span> <span class="va">ov_df</span><span class="op">$</span><span class="va">immune</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">kamp_real</span> <span class="op">&lt;-</span> <span class="fu">kamp</span><span class="op">(</span>ppp_obj <span class="op">=</span> <span class="va">ppp_real</span>,</span></span>
<span class="r-in"><span>                  rvals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  univariate <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                  marksvar1 <span class="op">=</span> <span class="st">"immune"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in breakpts.from.r(r):</span> First r value must be 0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">kamp_real</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'kamp_real' not found</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daisy Liao, Alex Soupir, Julia Wrobel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

